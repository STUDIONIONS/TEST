let nav=0,clicked=null,events=localStorage.getItem("events")?JSON.parse(localStorage.getItem("events")):{};const calendar=document.getElementById("calendar"),addEvent=document.getElementById("add"),newEventModal=document.getElementById("newEventModal"),deleteEventModal=document.getElementById("deleteEventModal"),backDrop=document.getElementById("modalBackDrop"),titleDate0=document.getElementById("titleDate0"),titleDate1=document.getElementById("titleDate1"),eventTitleDate=document.getElementById("eventTitleDate"),eventTitleInput=document.getElementById("eventTitleInput"),eventTitleWorker=document.getElementById("eventTitleWorker"),today=document.querySelectorAll(".today"),weekdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function openModal(e,t){var n=clicked==e;const l=e.split("/"),d=l.join(""),a=(l.join("-"),events["d-"+d]);clicked=e;let i=String(l[1]).padStart(2,"0")+"."+String(l[0]).padStart(2,"0")+"."+String(l[2]).padStart(4,"0"),o=String(l[2]).padStart(4,"0")+"-"+String(l[0]).padStart(2,"0")+"-"+String(l[1]).padStart(2,"0");null!=a&&t?t.id?(t=a[e=t.id.split("-")[2]],document.getElementById("eventText").innerText=t.title,document.getElementById("eventWorker").innerText=t.body,titleDate1.innerText=i,deleteEventModal.setAttribute("data-edit",e),deleteEventModal.setAttribute("data-date",d),deleteEventModal.style.display="block"):(newEventModal.style.display="block",titleDate0.innerText=i,eventTitleDate.style.display=n?"block":"none",titleDate0.style.display=n?"none":"block",setTimeout(function(){eventTitleInput.focus(),eventTitleDate.value=o},0)):(newEventModal.style.display="block",titleDate0.innerText=i,eventTitleDate.style.display=n?"none":"block",titleDate0.style.display=n?"block":"none",setTimeout(function(){eventTitleInput.focus(),eventTitleDate.value=o},0)),backDrop.style.display="flex"}function load(e){const t=new Date,l=(t.setDate(1),t.setMonth(t.getMonth()+nav),(new Date).getDate()),d=t.getMonth(),a=t.getFullYear(),n=new Date(a,d,0),r=new Date(a,d+1,0).getDate(),i=n.toLocaleDateString("en-us",{weekday:"long",year:"numeric",month:"numeric",day:"numeric"}),s=weekdays.indexOf(i.split(", ")[0]);function o(){for(let e=1;e<=s+r;e++){const i=document.createElement("div"),t=(i.classList.add("day"),`${d+1}/${e-s}/`+a),o="d-"+t.split("/").join("");if(e>s){i.setAttribute("data-curday",e-s);const n=Array.isArray(events[o])?events[o]:null;e-s===l&&0===nav&&(i.id="currentDay"),n&&Array.isArray(n)&&(i.classList.add("events"),n.forEach(function(e,t,n){let l=document.createElement("div"),d=document.createElement("div"),a=document.createElement("div");i.appendChild(a),l.classList.add("event"),d.classList.add("event"),l.innerText=e.title,d.innerText=e.body,a.appendChild(l),a.appendChild(d),a.classList.add("event_work"),a.title=`Ф.И.О: ${d.innerText}
Описание: `+l.innerText,a.id=o+"-"+t})),i.addEventListener("click",e=>(e.preventDefault(),openModal(clicked=t,e.target),!1))}else i.classList.add("padding");calendar.appendChild(i)}}document.getElementById("monthDisplay").innerText=t.toLocaleDateString("ru-ru",{month:"long"})+" "+a,calendar.innerHTML="",e?setTimeout(o,10):o()}function closeModal(){eventTitleInput.classList.remove("error"),eventTitleWorker.classList.remove("error"),newEventModal.style.display="none",deleteEventModal.style.display="none",backDrop.style.display="none",eventTitleInput.value="",eventTitleWorker.value="",clicked=null,deleteEventModal.removeAttribute("data-edit"),deleteEventModal.removeAttribute("data-date")}function saveEvent(){var e,t=eventTitleInput.value.trim(),n=eventTitleWorker.value.trim();t&&n?(eventTitleInput.classList.remove("error"),eventTitleWorker.classList.remove("error"),e="d-"+clicked.split("/").join(""),Array.isArray(events[e])||(events[e]=[]),events[e].length,events[e].push({date:clicked,title:t,body:n}),localStorage.setItem("events",JSON.stringify(Object.assign({},events))),load(),closeModal()):(eventTitleInput.classList.add("error"),eventTitleWorker.classList.add("error"))}function deleteEvent(){var e=deleteEventModal.getAttribute("data-edit"),t="d-"+deleteEventModal.getAttribute("data-date");events[t].splice(e,1),events[t].length||delete events[t],localStorage.setItem("events",JSON.stringify(events)),load(),closeModal()}function keyEnter(e){if(13==e.keyCode)return e.preventDefault(),saveEvent(),!1}function initButtons(){document.getElementById("nextButton").addEventListener("click",()=>{++nav,load(!0)}),document.getElementById("prevButton").addEventListener("click",()=>{--nav,load(!0)}),today.forEach(function(t){t.addEventListener("click",function(e){"update"!=t.id&&(nav=0),load(!0)})}),document.getElementById("saveButton").addEventListener("click",saveEvent),document.getElementById("cancelButton").addEventListener("click",closeModal),document.getElementById("deleteButton").addEventListener("click",deleteEvent),document.getElementById("closeButton").addEventListener("click",closeModal),eventTitleInput.addEventListener("keydown",keyEnter),eventTitleWorker.addEventListener("keydown",keyEnter),addEvent.addEventListener("click",e=>{e.preventDefault();let t=new Date,n=t.getDate(),l=t.getMonth(),d=t.getFullYear(),a=l+1+`/${n}/`+d;return clicked=null,openModal(a),!1}),load()}initButtons();