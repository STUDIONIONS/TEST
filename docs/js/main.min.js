!function(){let v=0,g=null;window.events=localStorage.getItem("events")?JSON.parse(localStorage.getItem("events")):{};const p=document.getElementById("calendar"),e=document.getElementById("add"),s=document.getElementById("newEventModal"),c=document.getElementById("deleteEventModal"),u=document.getElementById("modalBackDrop"),m=document.getElementById("titleDate0"),y=document.getElementById("titleDate1"),E=document.getElementById("eventTitleDate"),f=document.getElementById("eventTitleInput"),a=document.getElementById("eventTitleWorker"),t=document.querySelectorAll(".today"),r=document.getElementById("text-to-find"),o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function d(e){const t=new Date,c=(t.setDate(1),t.setMonth(t.getMonth()+v),(new Date).getDate()),n=t.getMonth(),u=t.getFullYear(),m=n+1,a=new Date(u,n,0),d=new Date(u,m,0).getDate(),l=a.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"numeric",day:"numeric"}),y=o.indexOf(l.split(", ")[0]);function i(){var t,s;for(let l=1;l<=y+d;l++){let i=document.createElement("div"),e=l-y,t=String(e).padStart(2,"0"),n=String(m).padStart(2,"0"),a=String(u),d=t+`/${n}/`+a,r="d-"+d.split("/").join(""),o=d.split("/").join(".");i.classList.add("day"),l>y?(i.setAttribute("data-curday",e),s=Array.isArray(events[r])?events[r]:null,e===c&&0===v&&i.classList.add("current_day"),s&&Array.isArray(s)&&(i.classList.add("events"),i.id=r,s.forEach(function(e,t,n){let a=document.createElement("div"),d=document.createElement("div"),l=document.createElement("div");i.appendChild(l),a.classList.add("event"),d.classList.add("event"),a.innerText=e.title,d.innerText=e.body,l.appendChild(a),l.appendChild(d),l.classList.add("event_work"),l.title=`Дата:
	${o}
Ф.И.О:
	${d.innerText}
Описание:
	`+a.innerText,l.id=r+"-"+t})),i.addEventListener("click",e=>{e.preventDefault(),g=d;let t=e.target.id,n=t.split("-"),a=2<n.length?Number(n[2]):null;return openModal(d,a),!1})):i.classList.add("padding"),p.appendChild(i)}if(t=(y+d)%7){t=7-t;for(let e=1;e<=t;++e){let e=document.createElement("div");e.classList.add("day"),e.classList.add("padding"),p.appendChild(e)}}var e=new Event("keyup");r.dispatchEvent(e)}document.getElementById("monthDisplay").innerText=t.toLocaleDateString(navigator.language,{month:"long"})+" "+u,p.innerHTML="",e?setTimeout(i,10):i()}function l(){f.classList.remove("error"),a.classList.remove("error"),s.style.display="none",c.style.display="none",u.style.display="none",f.value="",a.value="",E.value="",g=null,c.removeAttribute("data-edit"),c.removeAttribute("data-date")}function n(){var e,t=f.value.trim(),n=a.value.trim();t&&n?(f.classList.remove("error"),a.classList.remove("error"),e="d-"+E.value.split("-").reverse().join(""),Array.isArray(events[e])||(events[e]=[]),events[e].length,events[e].push({date:g,title:t,body:n}),localStorage.setItem("events",JSON.stringify(Object.assign({},events))),d(),l()):(f.classList.add("error"),a.classList.add("error"))}function i(){var e=c.getAttribute("data-edit"),t="d-"+c.getAttribute("data-date");events[t].splice(e,1),events[t].length||delete events[t],localStorage.setItem("events",JSON.stringify(events)),d(),l()}function L(e){if(13==e.keyCode)return e.preventDefault(),n(),!1}window.openModal=function(e,t){const n=g==e,a=e.split("/"),d=a.join(""),l=(a.join("-"),events["d-"+d]),i=new Date(a[2],a[1]-1,a[0]);g=e;let r=i.toLocaleDateString(navigator.language,{weekday:"long",year:"numeric",month:"long",day:"numeric"}),o=String(a[2]).padStart(4,"0")+"-"+String(a[1]).padStart(2,"0")+"-"+String(a[0]).padStart(2,"0");null!=l&&"number"==typeof t?(data=l[t])?(document.getElementById("eventText").innerText=data.title,document.getElementById("eventWorker").innerText=data.body,y.innerText=r,c.setAttribute("data-edit",t),c.setAttribute("data-date",d),c.style.display="block"):(s.style.display="block",m.innerText=r,E.style.display=n?"none":"block",m.style.display=n?"block":"none",setTimeout(function(){f.focus(),E.value=o},0)):(s.style.display="block",m.innerText=r,E.style.display=n?"none":"block",m.style.display=n?"block":"none",setTimeout(function(){f.focus(),E.value=o},0)),u.style.display="flex"},document.getElementById("nextButton").addEventListener("click",()=>{++v,d(!0)}),document.getElementById("prevButton").addEventListener("click",()=>{--v,d(!0)}),t.forEach(function(t){t.addEventListener("click",function(e){"update"!=t.id&&(v=0),d(!0)})}),document.getElementById("saveButton").addEventListener("click",n),document.getElementById("cancelButton").addEventListener("click",l),document.getElementById("deleteButton").addEventListener("click",i),document.getElementById("closeButton").addEventListener("click",l),f.addEventListener("keydown",L),a.addEventListener("keydown",L),e.addEventListener("click",e=>{e.preventDefault();let t=new Date,n=String(t.getDate()).padStart(2,"0"),a=String(t.getMonth()+1).padStart(2,"0"),d=String(t.getFullYear()),l=n+`/${a}/`+d;return g=null,openModal(l),!1}),r.addEventListener("keyup",function(e){return e.preventDefault(),search(this.value),!1}),r.addEventListener("blur",function(e){let t;(t=document.querySelector(".search_list"))&&setTimeout(function(){t.classList.remove("show")},200)}),r.addEventListener("focus",function(e){let t;(t=document.querySelector(".search_list"))&&t.classList.add("show")}),d()}();const search=function(e=""){let t=document.querySelectorAll(".search_list"),n=document.getElementById("search"),o=document.getElementById("text-to-find");Array.prototype.forEach.call(t,function(e){e.parentNode.removeChild(e)});const a=String(e).trim().normalize().replace(/((?:\\)|(?:\|)|(?:\[)|(?:\])|(?:\.)|(?:\+)|(?:\*)|(?:\?)|(?:\:)|(?:\!)|(?:\^)|(?:\()|(?:\))|(?:\{)|(?:\})|(?:\$))/gi,"\\$1"),s=new RegExp(a,"i");let d;if((d=document.querySelectorAll(".day .event_work"))&&d.forEach(function(e,t,n){e.classList.remove("red")}),0<a.length){let r=document.createElement("ul");for(var c in r.classList.add("search_list"),n&&n.append(r),events){let e=events[c];e.forEach(function(d,l,e){let i;if(null!==s.exec(d.title)||null!==s.exec(d.body)){let e=c+"-"+l,t=document.createElement("li"),n=document.createElement("span"),a=document.createElement("strong");t.setAttribute("data-date-item",e),n.innerText=d.title,a.innerText=d.body,t.append(a),t.append(n),r.append(t),document.activeElement===o&&r.classList.add("show"),t.addEventListener("click",function(e){e.preventDefault(),r.classList.add("show");const t=this.getAttribute("data-date-item"),n=t.split("-"),a=n[1],d=a.replace(/(\d{2})(\d{2})(\d{4})/,"$1/$2/$3");a.split("-")[1];return openModal(d,l),!1}),(i=document.getElementById(e))&&i.classList.add("red")}})}}};