const search=function(e=""){const t=e.normalize().replace(/((?:\\)|(?:\|)|(?:\[)|(?:\])|(?:\.)|(?:\+)|(?:\*)|(?:\?)|(?:\:)|(?:\!)|(?:\^)|(?:\()|(?:\))|(?:\{)|(?:\})|(?:\$))/gi,"\\$1"),a=new RegExp(t,"i");let n;if((n=document.querySelectorAll(".day .event_work"))&&n.forEach(function(e,t,n){console.log(e),e.classList.remove("red")}),2<t.length)for(var l in events){let e=events[l];e.forEach(function(e,t,n){let d;null===a.exec(e.title)&&null===a.exec(e.body)||(e=l+"-"+t,(d=document.getElementById(e))&&d.classList.add("red"))})}};let nav=0,clicked=null,events=localStorage.getItem("events")?JSON.parse(localStorage.getItem("events")):{};const calendar=document.getElementById("calendar"),addEvent=document.getElementById("add"),newEventModal=document.getElementById("newEventModal"),deleteEventModal=document.getElementById("deleteEventModal"),backDrop=document.getElementById("modalBackDrop"),titleDate0=document.getElementById("titleDate0"),titleDate1=document.getElementById("titleDate1"),eventTitleDate=document.getElementById("eventTitleDate"),eventTitleInput=document.getElementById("eventTitleInput"),eventTitleWorker=document.getElementById("eventTitleWorker"),today=document.querySelectorAll(".today"),findText=document.getElementById("text-to-find"),weekdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function openModal(e,t){var n=clicked==e;const d=e.split("/"),a=d.join(""),l=(d.join("-"),events["d-"+a]),i=new Date(d[2],d[0]-1,d[1]);clicked=e;let o=i.toLocaleDateString(navigator.language,{weekday:"long",year:"numeric",month:"long",day:"numeric"}),r=String(d[2]).padStart(4,"0")+"-"+String(d[0]).padStart(2,"0")+"-"+String(d[1]).padStart(2,"0");null!=l&&t&&t.id&&(t=l[e=t.id.split("-")[2]])?(document.getElementById("eventText").innerText=t.title,document.getElementById("eventWorker").innerText=t.body,titleDate1.innerText=o,deleteEventModal.setAttribute("data-edit",e),deleteEventModal.setAttribute("data-date",a),deleteEventModal.style.display="block"):(newEventModal.style.display="block",titleDate0.innerText=o,eventTitleDate.style.display=n?"none":"block",titleDate0.style.display=n?"block":"none",setTimeout(function(){eventTitleInput.focus(),eventTitleDate.value=r},0)),backDrop.style.display="flex"}function load(e){const t=new Date,d=(t.setDate(1),t.setMonth(t.getMonth()+nav),(new Date).getDate()),a=t.getMonth(),l=t.getFullYear(),n=new Date(l,a,0),i=new Date(l,a+1,0).getDate(),o=n.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"numeric",day:"numeric"}),c=weekdays.indexOf(o.split(", ")[0]);function r(){var t,n;for(let e=1;e<=c+i;e++){let i=document.createElement("div"),t=(i.classList.add("day"),`${a+1}/${e-c}/`+l),o="d-"+t.split("/").join(""),r=String(e-c).padStart(2,"0")+"."+String(a+1).padStart(2,"0")+"."+String(l);e>c?(i.setAttribute("data-curday",e-c),n=Array.isArray(events[o])?events[o]:null,e-c===d&&0===nav&&i.classList.add("current_day"),n&&Array.isArray(n)&&(i.classList.add("events"),i.id=o,n.forEach(function(e,t,n){let d=document.createElement("div"),a=document.createElement("div"),l=document.createElement("div");i.appendChild(l),d.classList.add("event"),a.classList.add("event"),d.innerText=e.title,a.innerText=e.body,l.appendChild(d),l.appendChild(a),l.classList.add("event_work"),l.title=`Дата:
	${r}
Ф.И.О:
	${a.innerText}
Описание:
	`+d.innerText,l.id=o+"-"+t})),i.addEventListener("click",e=>(e.preventDefault(),openModal(clicked=t,e.target),!1))):i.classList.add("padding"),calendar.appendChild(i)}if(t=(c+i)%7){t=7-t;for(let e=1;e<=t;++e){let e=document.createElement("div");e.classList.add("day"),e.classList.add("padding"),calendar.appendChild(e)}}var e=new Event("keyup");findText.dispatchEvent(e)}document.getElementById("monthDisplay").innerText=t.toLocaleDateString(navigator.language,{month:"long"})+" "+l,calendar.innerHTML="",e?setTimeout(r,10):r()}function closeModal(){eventTitleInput.classList.remove("error"),eventTitleWorker.classList.remove("error"),newEventModal.style.display="none",deleteEventModal.style.display="none",backDrop.style.display="none",eventTitleInput.value="",eventTitleWorker.value="",clicked=null,deleteEventModal.removeAttribute("data-edit"),deleteEventModal.removeAttribute("data-date")}function saveEvent(){var e,t=eventTitleInput.value.trim(),n=eventTitleWorker.value.trim();t&&n?(eventTitleInput.classList.remove("error"),eventTitleWorker.classList.remove("error"),e="d-"+clicked.split("/").join(""),Array.isArray(events[e])||(events[e]=[]),events[e].length,events[e].push({date:clicked,title:t,body:n}),localStorage.setItem("events",JSON.stringify(Object.assign({},events))),load(),closeModal()):(eventTitleInput.classList.add("error"),eventTitleWorker.classList.add("error"))}function deleteEvent(){var e=deleteEventModal.getAttribute("data-edit"),t="d-"+deleteEventModal.getAttribute("data-date");events[t].splice(e,1),events[t].length||delete events[t],localStorage.setItem("events",JSON.stringify(events)),load(),closeModal()}function keyEnter(e){if(13==e.keyCode)return e.preventDefault(),saveEvent(),!1}function initButtons(){document.getElementById("nextButton").addEventListener("click",()=>{++nav,load(!0)}),document.getElementById("prevButton").addEventListener("click",()=>{--nav,load(!0)}),today.forEach(function(t){t.addEventListener("click",function(e){"update"!=t.id&&(nav=0),load(!0)})}),document.getElementById("saveButton").addEventListener("click",saveEvent),document.getElementById("cancelButton").addEventListener("click",closeModal),document.getElementById("deleteButton").addEventListener("click",deleteEvent),document.getElementById("closeButton").addEventListener("click",closeModal),eventTitleInput.addEventListener("keydown",keyEnter),eventTitleWorker.addEventListener("keydown",keyEnter),addEvent.addEventListener("click",e=>{e.preventDefault();let t=new Date,n=t.getDate(),d=t.getMonth(),a=t.getFullYear(),l=d+1+`/${n}/`+a;return clicked=null,openModal(l),!1}),findText.addEventListener("keyup",function(e){return e.preventDefault(),search(this.value),!1}),load()}initButtons();